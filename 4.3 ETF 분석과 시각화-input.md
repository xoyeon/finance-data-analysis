[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/corazzon/finance-data-analysis/blob/main/4.3%20ETF%20%EB%B6%84%EC%84%9D%EA%B3%BC%20%EC%8B%9C%EA%B0%81%ED%99%94-input.ipynb)


## ETF 분석과 시각화

* keyword
    * seaborn - barplot, boxplot, violinplot
    * **seaborn PairGrid vs matplotlib - subplots**
    * seaborn FacetGrid
        * **catplot 범주형 데이터 시각화 (kind: count, bar, box, boxen, violin)**
        * relplot 연속된 수치 데이터 시각화 (kind: scatter, line) <= KRX 전체 종목 분석에서 다룸
    * pandas - value_counts, cross_tab, groupby, pivot_table
  
<img src="https://seaborn.pydata.org/_images/function_overview_8_0.png">

* seaborn 에 대해 좀 더 알고 싶다면 다음의 튜토리얼을 참고해 보세요.
* [User guide and tutorial — seaborn documentation](https://seaborn.pydata.org/tutorial.html)



* 특정 시점의 데이터를 저장해 분석합니다.
* 분석하는 시점에 따라 내용이 달라지는 점에 유의하세요!
* 내가 수집한 시점의 데이터를 분석하기 때문에 매일 분석한다면 일자별 리포트를 만들어 볼 수도 있을거에요.
* [ETF : 네이버 금융](https://finance.naver.com/sise/etf.nhn)


## ⚠️ 주의사항 ⚠️ 
*  분석내용은 데이터 수집 시점에 따라 달라집니다.

## 라이브러리 로드


```python
# 필요한 도구를 로드합니다.
# 데이터 분석을 위한 pandas, 수치계산을 위한 numpy, 시각화를 위한 seaborn, matplotlib
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
```


```python
# seaborn 의 버전을 확인합니다. 
# 0.11.0 이상의 버전에서 변경된 내용이 많으니 0.11 이상의 버전을 사용해 주세요.
sns.__version__
```




    '0.11.1'




```python
pd.__version__
```




    '1.2.4'



## 시각화를 위한 한글폰트 설정


```python
def get_font_family():
    """
    시스템 환경에 따른 기본 폰트명을 반환하는 함수
    """
    import platform
    system_name = platform.system()
    # colab 사용자는 system_name이 'Linux'로 확인

    if system_name == "Darwin" :
        font_family = "AppleGothic"
    elif system_name == "Windows":
        font_family = "Malgun Gothic"
    else:
        # Linux
        # colab에서는 runtime을 <꼭> 재시작 해야합니다.
        # 런타임을 재시작 하지 않고 폰트 설치를 하면 기본 설정 폰트가 로드되어 한글이 깨집니다.
        !apt-get update -qq
        !apt-get install fonts-nanum -qq  > /dev/null

        import matplotlib.font_manager as fm

        fontpath = '/usr/share/fonts/truetype/nanum/NanumBarunGothic.ttf'
        font = fm.FontProperties(fname=fontpath, size=9)
        fm._rebuild()
        font_family = "NanumBarunGothic"
    return font_family
```


```python
# 사용가능한 그래프 스타일
print(plt.style.available)
```

    ['Solarize_Light2', '_classic_test_patch', 'bmh', 'classic', 'dark_background', 'fast', 'fivethirtyeight', 'ggplot', 'grayscale', 'seaborn', 'seaborn-bright', 'seaborn-colorblind', 'seaborn-dark', 'seaborn-dark-palette', 'seaborn-darkgrid', 'seaborn-deep', 'seaborn-muted', 'seaborn-notebook', 'seaborn-paper', 'seaborn-pastel', 'seaborn-poster', 'seaborn-talk', 'seaborn-ticks', 'seaborn-white', 'seaborn-whitegrid', 'tableau-colorblind10']
    


```python
# 운영체제에 맞는 font_family 찾기 
get_font_family()
```




    'Malgun Gothic'




```python
# 그래프 스타일 설정
# plt.style.use("fivethirtyeight")
# plt.style.use("bmh")
plt.style.use("seaborn")

# dark mode 사용자를 위한 스타일 추천
# plt.style.use("dark_background")

# 폰트설정
plt.rc("font", family=get_font_family())

# 마이너스폰트 설정
plt.rc("axes", unicode_minus=False)

# 그래프에 retina display 적용
from IPython.display import set_matplotlib_formats
set_matplotlib_formats('retina')
```


```python
# 한글폰트 확인
pd.Series([1,3,5,-7,9]).plot(title="한글")
```




    <AxesSubplot:title={'center':'한글'}>




    
![png](output_10_1.png)
    


## 데이터 로드


```python
# 이전 수업에서 수집해서 저장해둔 csv 파일을 읽어옵니다.
# itemcode 숫자 앞의 0 이 지워진다면 
# dtype={"종목코드": np.object} 로 타입을 지정해 주면 문자형태로 읽어옵니다.
df = pd.read_csv('etf_21_07_28.csv', dtype={"종목코드": np.object})
df.shape
```




    (489, 17)




```python
# 인덱스 번호 상단 5개의 데이터를 가져옵니다.
# 제대로 read되었는지 각 column정보들을 확인합니다.
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>종목코드</th>
      <th>탭코드</th>
      <th>종목명</th>
      <th>현재가</th>
      <th>등락구분</th>
      <th>전일비</th>
      <th>등락률</th>
      <th>순자산가치(NAV)</th>
      <th>3개월수익률</th>
      <th>거래량</th>
      <th>거래대금(백만)</th>
      <th>시가총액(억)</th>
      <th>유형</th>
      <th>브랜드</th>
      <th>인버스</th>
      <th>레버리지</th>
      <th>환헤지H</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>069500</td>
      <td>1</td>
      <td>KODEX 200</td>
      <td>43005</td>
      <td>2</td>
      <td>130</td>
      <td>0.30</td>
      <td>43027.0</td>
      <td>-0.7363</td>
      <td>2409683</td>
      <td>103245</td>
      <td>41672</td>
      <td>국내</td>
      <td>KODEX</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>153130</td>
      <td>6</td>
      <td>KODEX 단기채권</td>
      <td>102845</td>
      <td>3</td>
      <td>0</td>
      <td>0.00</td>
      <td>102846.0</td>
      <td>0.0340</td>
      <td>16993</td>
      <td>1747</td>
      <td>24206</td>
      <td>파생</td>
      <td>KODEX</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>252670</td>
      <td>3</td>
      <td>KODEX 200선물인버스2X</td>
      <td>1930</td>
      <td>5</td>
      <td>-10</td>
      <td>-0.52</td>
      <td>1930.0</td>
      <td>0.0000</td>
      <td>208493318</td>
      <td>404593</td>
      <td>22070</td>
      <td>국내</td>
      <td>KODEX</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>102110</td>
      <td>1</td>
      <td>TIGER 200</td>
      <td>43020</td>
      <td>2</td>
      <td>85</td>
      <td>0.20</td>
      <td>43060.0</td>
      <td>-0.7054</td>
      <td>917304</td>
      <td>39354</td>
      <td>21575</td>
      <td>국내</td>
      <td>TIGER</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>102780</td>
      <td>2</td>
      <td>KODEX 삼성그룹</td>
      <td>10570</td>
      <td>2</td>
      <td>35</td>
      <td>0.33</td>
      <td>10594.0</td>
      <td>3.2033</td>
      <td>254361</td>
      <td>2680</td>
      <td>18180</td>
      <td>시장지수</td>
      <td>KODEX</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 인덱스 하단의 5개 데이터를 가져옵니다.
# 데이터가 제대로 로드되었는지 확인합니다.
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>종목코드</th>
      <th>탭코드</th>
      <th>종목명</th>
      <th>현재가</th>
      <th>등락구분</th>
      <th>전일비</th>
      <th>등락률</th>
      <th>순자산가치(NAV)</th>
      <th>3개월수익률</th>
      <th>거래량</th>
      <th>거래대금(백만)</th>
      <th>시가총액(억)</th>
      <th>유형</th>
      <th>브랜드</th>
      <th>인버스</th>
      <th>레버리지</th>
      <th>환헤지H</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>484</th>
      <td>267500</td>
      <td>4</td>
      <td>KBSTAR 미국장기국채선물인버스2X(합성 H)</td>
      <td>5790</td>
      <td>5</td>
      <td>-60</td>
      <td>-1.03</td>
      <td>NaN</td>
      <td>-11.8976</td>
      <td>6161</td>
      <td>35</td>
      <td>26</td>
      <td>업종/테마</td>
      <td>KBSTAR</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>485</th>
      <td>287330</td>
      <td>2</td>
      <td>KBSTAR 200생활소비재</td>
      <td>8880</td>
      <td>2</td>
      <td>30</td>
      <td>0.34</td>
      <td>8890.0</td>
      <td>-1.7213</td>
      <td>2235</td>
      <td>19</td>
      <td>21</td>
      <td>시장지수</td>
      <td>KBSTAR</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>486</th>
      <td>334700</td>
      <td>5</td>
      <td>KBSTAR 팔라듐선물인버스(H)</td>
      <td>4545</td>
      <td>2</td>
      <td>75</td>
      <td>1.68</td>
      <td>NaN</td>
      <td>5.1764</td>
      <td>1855</td>
      <td>8</td>
      <td>18</td>
      <td>국내</td>
      <td>KBSTAR</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>487</th>
      <td>287310</td>
      <td>2</td>
      <td>KBSTAR 200경기소비재</td>
      <td>11835</td>
      <td>5</td>
      <td>-80</td>
      <td>-0.67</td>
      <td>11871.0</td>
      <td>3.1691</td>
      <td>323</td>
      <td>3</td>
      <td>17</td>
      <td>시장지수</td>
      <td>KBSTAR</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>488</th>
      <td>287320</td>
      <td>2</td>
      <td>KBSTAR 200산업재</td>
      <td>13370</td>
      <td>2</td>
      <td>30</td>
      <td>0.22</td>
      <td>13371.0</td>
      <td>9.1653</td>
      <td>3382</td>
      <td>45</td>
      <td>16</td>
      <td>시장지수</td>
      <td>KBSTAR</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>




```python
# info를 통해서 각 column들의 데이터타입과 결측치, 메모리 사용량 등을 볼 수 있습니다.
df.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 489 entries, 0 to 488
    Data columns (total 17 columns):
     #   Column      Non-Null Count  Dtype  
    ---  ------      --------------  -----  
     0   종목코드        489 non-null    object 
     1   탭코드         489 non-null    int64  
     2   종목명         489 non-null    object 
     3   현재가         489 non-null    int64  
     4   등락구분        489 non-null    int64  
     5   전일비         489 non-null    int64  
     6   등락률         489 non-null    float64
     7   순자산가치(NAV)  348 non-null    float64
     8   3개월수익률      467 non-null    float64
     9   거래량         489 non-null    int64  
     10  거래대금(백만)    489 non-null    int64  
     11  시가총액(억)     489 non-null    int64  
     12  유형          489 non-null    object 
     13  브랜드         489 non-null    object 
     14  인버스         489 non-null    bool   
     15  레버리지        489 non-null    bool   
     16  환헤지H        489 non-null    bool   
    dtypes: bool(3), float64(3), int64(7), object(4)
    memory usage: 55.0+ KB
    

## 결측치 확인


```python
# 결측치 비율 확인
(True + True + False) / 3
```




    0.6666666666666666




```python
# 결측치를 확인합니다.
df.isnull().sum()
```




    종목코드            0
    탭코드             0
    종목명             0
    현재가             0
    등락구분            0
    전일비             0
    등락률             0
    순자산가치(NAV)    141
    3개월수익률         22
    거래량             0
    거래대금(백만)        0
    시가총액(억)         0
    유형              0
    브랜드             0
    인버스             0
    레버리지            0
    환헤지H            0
    dtype: int64




```python
# 결측치의 비율을 봅니다.
df.isnull().mean() * 100
```




    종목코드           0.000000
    탭코드            0.000000
    종목명            0.000000
    현재가            0.000000
    등락구분           0.000000
    전일비            0.000000
    등락률            0.000000
    순자산가치(NAV)    28.834356
    3개월수익률         4.498978
    거래량            0.000000
    거래대금(백만)       0.000000
    시가총액(억)        0.000000
    유형             0.000000
    브랜드            0.000000
    인버스            0.000000
    레버리지           0.000000
    환헤지H           0.000000
    dtype: float64




```python
# heatmap을 통한 결측치 시각화
plt.figure(figsize=(10,4))
sns.heatmap(df.isnull(), cmap="Greys_r")
```




    <AxesSubplot:>




    
![png](output_20_1.png)
    


## 범주형 데이터의 빈도수
### 범주형 변수 찾기


```python
# describe를 통해 범주형 변수에 대한 기술통계 값을 구하기
df.describe(include="object")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>종목코드</th>
      <th>종목명</th>
      <th>유형</th>
      <th>브랜드</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>489</td>
      <td>489</td>
      <td>489</td>
      <td>489</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>489</td>
      <td>489</td>
      <td>5</td>
      <td>18</td>
    </tr>
    <tr>
      <th>top</th>
      <td>272910</td>
      <td>ARIRANG KS퀄리티가중TR</td>
      <td>시장지수</td>
      <td>TIGER</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>1</td>
      <td>1</td>
      <td>180</td>
      <td>128</td>
    </tr>
  </tbody>
</table>
</div>




```python
# unique(중복을 제외한 값)에 대한 빈도수 구하기
# object type 이 아니더라도 nunique 값이 작다면 범주형 변수인지 확인해 봅니다.
df.nunique()
```




    종목코드          489
    탭코드             7
    종목명           489
    현재가           463
    등락구분            3
    전일비           101
    등락률           209
    순자산가치(NAV)    345
    3개월수익률        463
    거래량           451
    거래대금(백만)      285
    시가총액(억)       355
    유형              5
    브랜드            18
    인버스             2
    레버리지            2
    환헤지H            2
    dtype: int64



### ETF 상품 유형별 빈도수(한 개의 변수)


```python
# df["유형"].value_counts() 의 결과와 같게 시각화 할 수 있습니다.
df["유형"].value_counts()
```




    시장지수     180
    국내       110
    업종/테마    110
    파생        58
    해외        31
    Name: 유형, dtype: int64




```python
# sns.countplot 으로 빈도수를 시각화 합니다.
sns.countplot(data=df, x='유형')
```




    <AxesSubplot:xlabel='유형', ylabel='count'>




    
![png](output_26_1.png)
    



```python
# value_counts 로 빈도수를 직접 계산합니다.
df["유형"].value_counts()
```




    시장지수     180
    국내       110
    업종/테마    110
    파생        58
    해외        31
    Name: 유형, dtype: int64




```python
# value_counts(normalize=True) 로 빈도수의 비율을 구합니다.
df["유형"].value_counts(normalize=True) * 100
```




    시장지수     36.809816
    국내       22.494888
    업종/테마    22.494888
    파생       11.860941
    해외        6.339468
    Name: 유형, dtype: float64



### 두 개의 변수 빈도수와 비율


```python
# 유형 컬럼의 빈도수를 봅니다.
# seaborn countplot의 hue를 이용하여 인버스여부에 따라 다른 색상으로 표시해 봅니다.
sns.countplot(data = df, x='유형', hue='인버스')
```




    <AxesSubplot:xlabel='유형', ylabel='count'>




    
![png](output_30_1.png)
    



```python
# pandas crosstab을 이용하여 위 그래프의 수치를 확인 할 수 있습니다.
# seaborn 은 아래와 같은 연산을 하지 않더라도 알아서 통계적 연산을 시각화 해줍니다.
pd.crosstab(df['인버스'], df['유형'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>유형</th>
      <th>국내</th>
      <th>시장지수</th>
      <th>업종/테마</th>
      <th>파생</th>
      <th>해외</th>
    </tr>
    <tr>
      <th>인버스</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>90</td>
      <td>180</td>
      <td>99</td>
      <td>51</td>
      <td>27</td>
    </tr>
    <tr>
      <th>True</th>
      <td>20</td>
      <td>0</td>
      <td>11</td>
      <td>7</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>




```python
# value_counts 처럼 normalize 를 사용해 비율을 구할 수도 있습니다.
pd.crosstab(df['인버스'], df['유형'], normalize=True) * 100
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>유형</th>
      <th>국내</th>
      <th>시장지수</th>
      <th>업종/테마</th>
      <th>파생</th>
      <th>해외</th>
    </tr>
    <tr>
      <th>인버스</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>18.404908</td>
      <td>36.809816</td>
      <td>20.245399</td>
      <td>10.429448</td>
      <td>5.521472</td>
    </tr>
    <tr>
      <th>True</th>
      <td>4.089980</td>
      <td>0.000000</td>
      <td>2.249489</td>
      <td>1.431493</td>
      <td>0.817996</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 동일하게 유형 데이터를 레버리지 여부에 따라 그립니다.
sns.countplot(data = df, x='유형', hue='레버리지')
```




    <AxesSubplot:xlabel='유형', ylabel='count'>




    
![png](output_33_1.png)
    



```python
# 레버리지, 유형에 대한 빈도수를 구힙니다.
pd.crosstab(df['레버리지'], df['유형'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>유형</th>
      <th>국내</th>
      <th>시장지수</th>
      <th>업종/테마</th>
      <th>파생</th>
      <th>해외</th>
    </tr>
    <tr>
      <th>레버리지</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>94</td>
      <td>177</td>
      <td>99</td>
      <td>57</td>
      <td>29</td>
    </tr>
    <tr>
      <th>True</th>
      <td>16</td>
      <td>3</td>
      <td>11</td>
      <td>1</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 레버리지, 유형에 대한 빈도수의 비율을 구합니다.
pd.crosstab(df['레버리지'], df['유형'], normalize=True) * 100
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>유형</th>
      <th>국내</th>
      <th>시장지수</th>
      <th>업종/테마</th>
      <th>파생</th>
      <th>해외</th>
    </tr>
    <tr>
      <th>레버리지</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>19.222904</td>
      <td>36.196319</td>
      <td>20.245399</td>
      <td>11.656442</td>
      <td>5.930470</td>
    </tr>
    <tr>
      <th>True</th>
      <td>3.271984</td>
      <td>0.613497</td>
      <td>2.249489</td>
      <td>0.204499</td>
      <td>0.408998</td>
    </tr>
  </tbody>
</table>
</div>



### 브랜드별 빈도수


```python
# 브랜드별 ETF 빈도수
df['브랜드'].value_counts()
```




    TIGER        128
    KODEX        123
    KBSTAR        82
    KINDEX        47
    ARIRANG       40
    KOSEF         26
    HANARO        19
    SMART          5
    파워             4
    마이티            2
    TIMEFOLIO      2
    HK             2
    TREX           2
    네비게이터          2
    FOCUS          2
    흥국             1
    마이다스           1
    KTOP           1
    Name: 브랜드, dtype: int64




```python
plt.figure(figsize=(15,4))
sns.countplot(data=df, x='브랜드')
```




    <AxesSubplot:xlabel='브랜드', ylabel='count'>




    
![png](output_38_1.png)
    


### 인버스, 브랜드의 ETF 빈도 비율


* 인버스 ETF란? 주식관련 장내 외 파생상품 투자 및 증권차입매도 등을 통해 기초지수(KOSPI 200지수)의 일일 변동률(일별수익률)을 음의 1배수 즉, 역방향으로 추적하는 ETF를 말한다. 예를 들어, KOSPI 200지수가 1% 상승할 경우 인버스 ETF는 마이너스 1% 수익률, 반대로 KOSPI 200 지수가 1% 하락시 인버스 ETF는 플러스 1%의 수익률을 목표로 운영된다.
[네이버 지식백과] 인버스ETF (매일경제, 매경닷컴)
* 출처 : https://terms.naver.com/entry.nhn?docId=20336&cid=43659&categoryId=43659


```python
# 브랜드 column의 빈도수를 인버스에 따른 구분으로 그려봅니다.
plt.figure(figsize=(15,4))
sns.countplot(data=df, x='브랜드', hue='인버스')
```




    <AxesSubplot:xlabel='브랜드', ylabel='count'>




    
![png](output_40_1.png)
    



```python
# 인버스, 브랜드의 금융상품 빈도수
pd.crosstab(df['인버스'], df['브랜드'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>브랜드</th>
      <th>ARIRANG</th>
      <th>FOCUS</th>
      <th>HANARO</th>
      <th>HK</th>
      <th>KBSTAR</th>
      <th>KINDEX</th>
      <th>KODEX</th>
      <th>KOSEF</th>
      <th>KTOP</th>
      <th>SMART</th>
      <th>TIGER</th>
      <th>TIMEFOLIO</th>
      <th>TREX</th>
      <th>네비게이터</th>
      <th>마이다스</th>
      <th>마이티</th>
      <th>파워</th>
      <th>흥국</th>
    </tr>
    <tr>
      <th>인버스</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>37</td>
      <td>2</td>
      <td>18</td>
      <td>2</td>
      <td>73</td>
      <td>43</td>
      <td>112</td>
      <td>21</td>
      <td>1</td>
      <td>5</td>
      <td>119</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>True</th>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>9</td>
      <td>4</td>
      <td>11</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 인버스, 브랜드의 금융상품 빈도 비율
in_brand_norm = pd.crosstab(df['인버스'], df['브랜드'], normalize=True) * 100
in_brand_norm
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>브랜드</th>
      <th>ARIRANG</th>
      <th>FOCUS</th>
      <th>HANARO</th>
      <th>HK</th>
      <th>KBSTAR</th>
      <th>KINDEX</th>
      <th>KODEX</th>
      <th>KOSEF</th>
      <th>KTOP</th>
      <th>SMART</th>
      <th>TIGER</th>
      <th>TIMEFOLIO</th>
      <th>TREX</th>
      <th>네비게이터</th>
      <th>마이다스</th>
      <th>마이티</th>
      <th>파워</th>
      <th>흥국</th>
    </tr>
    <tr>
      <th>인버스</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>7.566462</td>
      <td>0.408998</td>
      <td>3.680982</td>
      <td>0.408998</td>
      <td>14.928425</td>
      <td>8.793456</td>
      <td>22.903885</td>
      <td>4.294479</td>
      <td>0.204499</td>
      <td>1.022495</td>
      <td>24.335378</td>
      <td>0.408998</td>
      <td>0.408998</td>
      <td>0.408998</td>
      <td>0.204499</td>
      <td>0.408998</td>
      <td>0.817996</td>
      <td>0.204499</td>
    </tr>
    <tr>
      <th>True</th>
      <td>0.613497</td>
      <td>0.000000</td>
      <td>0.204499</td>
      <td>0.000000</td>
      <td>1.840491</td>
      <td>0.817996</td>
      <td>2.249489</td>
      <td>1.022495</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.840491</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>



### 레버리지, 브랜드의 ETF 빈도 비율
* 레버리지 ETF란? 일반 ETF가 코스피200과 같은 지수 내 대표 주식을 보유함으로써 지수와 비슷한 수익률을 내는 것을 목표로 하는 데 비해 레버리지ETF는 선물 등 파생상품에 투자해 지수보다 높은 수익을 추구하는 ETF다. 상승장에서는 높은 수익률을 기대할 수 있지만 하락장에서는 손실도 커져 고위험ㆍ고수익 상품으로 분류된다.
[네이버 지식백과] 레버리지 ETF (매일경제, 매경닷컴)
* 출처 : https://terms.naver.com/entry.nhn?docId=2059802&cid=43659&categoryId=43659


```python
# 브랜드별 레버리지 여부에 따른 빈도수를 시각화 합니다.
plt.figure(figsize=(15,4))
sns.countplot(data=df, x='브랜드', hue='레버리지')
```




    <AxesSubplot:xlabel='브랜드', ylabel='count'>




    
![png](output_44_1.png)
    



```python
# 레버리지, 브랜드의 ETF 빈도수(crosstab)
pd.crosstab(df['레버리지'], df['브랜드'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>브랜드</th>
      <th>ARIRANG</th>
      <th>FOCUS</th>
      <th>HANARO</th>
      <th>HK</th>
      <th>KBSTAR</th>
      <th>KINDEX</th>
      <th>KODEX</th>
      <th>KOSEF</th>
      <th>KTOP</th>
      <th>SMART</th>
      <th>TIGER</th>
      <th>TIMEFOLIO</th>
      <th>TREX</th>
      <th>네비게이터</th>
      <th>마이다스</th>
      <th>마이티</th>
      <th>파워</th>
      <th>흥국</th>
    </tr>
    <tr>
      <th>레버리지</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>39</td>
      <td>2</td>
      <td>17</td>
      <td>2</td>
      <td>78</td>
      <td>42</td>
      <td>118</td>
      <td>22</td>
      <td>1</td>
      <td>5</td>
      <td>117</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>True</th>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>4</td>
      <td>5</td>
      <td>5</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>11</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 레버리지, 브랜드의 ETF 비율
pd.crosstab(df['레버리지'], df['브랜드'], normalize=True) * 100
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>브랜드</th>
      <th>ARIRANG</th>
      <th>FOCUS</th>
      <th>HANARO</th>
      <th>HK</th>
      <th>KBSTAR</th>
      <th>KINDEX</th>
      <th>KODEX</th>
      <th>KOSEF</th>
      <th>KTOP</th>
      <th>SMART</th>
      <th>TIGER</th>
      <th>TIMEFOLIO</th>
      <th>TREX</th>
      <th>네비게이터</th>
      <th>마이다스</th>
      <th>마이티</th>
      <th>파워</th>
      <th>흥국</th>
    </tr>
    <tr>
      <th>레버리지</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>7.975460</td>
      <td>0.408998</td>
      <td>3.476483</td>
      <td>0.408998</td>
      <td>15.950920</td>
      <td>8.588957</td>
      <td>24.130879</td>
      <td>4.498978</td>
      <td>0.204499</td>
      <td>1.022495</td>
      <td>23.926380</td>
      <td>0.408998</td>
      <td>0.408998</td>
      <td>0.408998</td>
      <td>0.204499</td>
      <td>0.204499</td>
      <td>0.817996</td>
      <td>0.204499</td>
    </tr>
    <tr>
      <th>True</th>
      <td>0.204499</td>
      <td>0.000000</td>
      <td>0.408998</td>
      <td>0.000000</td>
      <td>0.817996</td>
      <td>1.022495</td>
      <td>1.022495</td>
      <td>0.817996</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.249489</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.204499</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>



## 수치형 변수의 기술통계


```python
# describe로 수치형 변수의 기술통계 구하기
# desc
df.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>탭코드</th>
      <th>현재가</th>
      <th>등락구분</th>
      <th>전일비</th>
      <th>등락률</th>
      <th>순자산가치(NAV)</th>
      <th>3개월수익률</th>
      <th>거래량</th>
      <th>거래대금(백만)</th>
      <th>시가총액(억)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>489.000000</td>
      <td>489.000000</td>
      <td>489.000000</td>
      <td>489.000000</td>
      <td>489.000000</td>
      <td>348.000000</td>
      <td>467.000000</td>
      <td>4.890000e+02</td>
      <td>489.000000</td>
      <td>489.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.257669</td>
      <td>23794.447853</td>
      <td>3.758691</td>
      <td>-34.907975</td>
      <td>-0.206462</td>
      <td>27028.045977</td>
      <td>1.301583</td>
      <td>7.485299e+05</td>
      <td>5185.764826</td>
      <td>1219.503067</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.805918</td>
      <td>25884.176998</td>
      <td>1.438298</td>
      <td>122.681121</td>
      <td>0.732923</td>
      <td>28559.836804</td>
      <td>6.410780</td>
      <td>9.724373e+06</td>
      <td>30645.128529</td>
      <td>3403.589879</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>1920.000000</td>
      <td>2.000000</td>
      <td>-1005.000000</td>
      <td>-3.410000</td>
      <td>1917.000000</td>
      <td>-31.163500</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>16.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.000000</td>
      <td>10570.000000</td>
      <td>2.000000</td>
      <td>-85.000000</td>
      <td>-0.540000</td>
      <td>11098.000000</td>
      <td>-1.215500</td>
      <td>4.370000e+02</td>
      <td>8.000000</td>
      <td>84.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.000000</td>
      <td>13900.000000</td>
      <td>5.000000</td>
      <td>-15.000000</td>
      <td>-0.080000</td>
      <td>14769.500000</td>
      <td>0.563500</td>
      <td>5.358000e+03</td>
      <td>76.000000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4.000000</td>
      <td>21310.000000</td>
      <td>5.000000</td>
      <td>30.000000</td>
      <td>0.200000</td>
      <td>28663.000000</td>
      <td>3.759850</td>
      <td>4.459700e+04</td>
      <td>608.000000</td>
      <td>683.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>7.000000</td>
      <td>133775.000000</td>
      <td>5.000000</td>
      <td>300.000000</td>
      <td>1.680000</td>
      <td>134007.000000</td>
      <td>48.079500</td>
      <td>2.084933e+08</td>
      <td>404593.000000</td>
      <td>41672.000000</td>
    </tr>
  </tbody>
</table>
</div>



## 수치형 변수로 히스토그램 그리기

* 연속된 수치 데이터를 범주형 데이터로 표현, bucketing 이라고 부르기도 함
* 히스토그램 : 도수분포를 그래프 형태로 표현한 것
* 막대그래프와 비슷해 보이지만 다른 그래프
* 참고 : [히스토그램 - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/%ED%9E%88%EC%8A%A4%ED%86%A0%EA%B7%B8%EB%9E%A8)


```python
# 수치형 컬럼만 리스트로 만들기
# num_cols
_ = df.hist()
```


    
![png](output_50_0.png)
    



```python
# 위의 df.hist()에서 오류가 난다면 boolean type 때문이니, 아래와 같은 방법을 사용
num_cols = df.select_dtypes(include=np.number).hist(figsize=(12,10), bins=100)
```


    
![png](output_51_0.png)
    



```python
# 히스토그램을 그려보면 수치 데이터로 되어있지만 범주형 데이터를 찾아볼 수 있습니다.
```

## 범주형 vs 수치형 변수
### seaborn의 barplot 이해하기


```python
# seaborn의 bar chart를 이용하여 각 브랜드에 대한 3개월수익률의 평균값을 볼 수 있습니다.
# 검은색 막대는 ci로 신뢰구간을 의미합니다.
sns.barplot(data=df, y="브랜드", x="3개월수익률", ci=None)
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='브랜드'>




    
![png](output_54_1.png)
    


### barplot 그래프의 값을 groupby 로 직접 구하기


```python
# 위 그래프의 평균 값을 직접 계산을 통해 구해 봅니다.
brand_3month_mean = df.groupby("브랜드")['3개월수익률'].mean().sort_values(ascending=False)
brand_3month_mean.head()
```




    브랜드
    흥국        4.977600
    SMART     2.092920
    KINDEX    1.951685
    TIGER     1.938860
    HANARO    1.841317
    Name: 3개월수익률, dtype: float64




```python
# 위에서 구한 그룹(브랜드)별 평균 3개월 수익률을 그래프로 표현합니다.
brand_3month_mean.plot.barh()
plt.axvline(0)
```




    <matplotlib.lines.Line2D at 0x2c3fa0a97c0>




    
![png](output_57_1.png)
    



```python
# 브랜드가 마이티인 경우의 데이터를 확인합니다.
df[df['브랜드'] == '마이티']
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>종목코드</th>
      <th>탭코드</th>
      <th>종목명</th>
      <th>현재가</th>
      <th>등락구분</th>
      <th>전일비</th>
      <th>등락률</th>
      <th>순자산가치(NAV)</th>
      <th>3개월수익률</th>
      <th>거래량</th>
      <th>거래대금(백만)</th>
      <th>시가총액(억)</th>
      <th>유형</th>
      <th>브랜드</th>
      <th>인버스</th>
      <th>레버리지</th>
      <th>환헤지H</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>354</th>
      <td>159800</td>
      <td>1</td>
      <td>마이티 코스피100</td>
      <td>32565</td>
      <td>5</td>
      <td>-10</td>
      <td>-0.03</td>
      <td>32608.0</td>
      <td>-0.8100</td>
      <td>2</td>
      <td>0</td>
      <td>91</td>
      <td>국내</td>
      <td>마이티</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>416</th>
      <td>292340</td>
      <td>2</td>
      <td>마이티 200커버드콜ATM레버리지</td>
      <td>11060</td>
      <td>5</td>
      <td>-70</td>
      <td>-0.63</td>
      <td>11147.0</td>
      <td>3.6795</td>
      <td>207</td>
      <td>2</td>
      <td>66</td>
      <td>시장지수</td>
      <td>마이티</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 브랜드 대비 3개월수익률에 대한 정보를 레버리지 값의 차이를 barplot으로 봅니다.
# 레버리지 유/무에 따라서 평균 3개월 수익률은 많은 차이가 없지만,
# 표준편차의 경우 레버리지가 있을경우 굉장히 편차(ci="sd")가 심함을 알 수 있습니다.
# 레버리지 상품은 오를 때 더 많이 오르고 내릴 때 더 많이 내립니다.
sns.barplot(data=df, x="3개월수익률", y="브랜드", hue="레버리지", ci=None)
plt.axvline(0, c='k', linewidth=.5)
```




    <matplotlib.lines.Line2D at 0x2c3f8f34ca0>




    
![png](output_59_1.png)
    


* [Styling — pandas documentation](https://pandas.pydata.org/pandas-docs/stable/user_guide/style.html)


```python
# 위에서 그린 그래프의 값을 groupby로 구합니다.
df.groupby(['브랜드', '레버리지'])['3개월수익률'].mean().unstack()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>레버리지</th>
      <th>False</th>
      <th>True</th>
    </tr>
    <tr>
      <th>브랜드</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ARIRANG</th>
      <td>1.864600</td>
      <td>-1.784000</td>
    </tr>
    <tr>
      <th>FOCUS</th>
      <td>1.118400</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>HANARO</th>
      <td>2.086712</td>
      <td>-0.121850</td>
    </tr>
    <tr>
      <th>HK</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>KBSTAR</th>
      <td>0.490522</td>
      <td>3.239450</td>
    </tr>
    <tr>
      <th>KINDEX</th>
      <td>1.686929</td>
      <td>4.175640</td>
    </tr>
    <tr>
      <th>KODEX</th>
      <td>0.870048</td>
      <td>-5.389680</td>
    </tr>
    <tr>
      <th>KOSEF</th>
      <td>0.844740</td>
      <td>2.788475</td>
    </tr>
    <tr>
      <th>KTOP</th>
      <td>-1.231000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>SMART</th>
      <td>2.092920</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>TIGER</th>
      <td>2.059565</td>
      <td>0.698891</td>
    </tr>
    <tr>
      <th>TIMEFOLIO</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>TREX</th>
      <td>-0.624250</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>네비게이터</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>마이다스</th>
      <td>0.610100</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>마이티</th>
      <td>-0.810000</td>
      <td>3.679500</td>
    </tr>
    <tr>
      <th>파워</th>
      <td>0.970425</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>흥국</th>
      <td>4.977600</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



### boxplot으로 그리기

#### 기술통계 용어

* 백분위 수 : 데이터를 백등분 한 것
* 사분위 수 : 데이터를 4등분 한 것
* 중위수 : 데이터의 정 가운데 순위에 해당하는 값.(관측치의 절반은 크거나 같고 나머지 절반은 작거나 같다.)
* 제 3사분위 수 (Q3) : 중앙값 기준으로 상위 50% 중의 중앙값, 전체 데이터 중 상위 25%에 해당하는 값
* 제 1사분위 수 (Q1) : 중앙값 기준으로 하위 50% 중의 중앙값, 전체 데이터 중 하위 25%에 해당하는 값
* 사분위 범위 수(IQR) : 데이터의 중간 50% (Q3 - Q1)

* 출처 : [상자 수염 그림 - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/%EC%83%81%EC%9E%90_%EC%88%98%EC%97%BC_%EA%B7%B8%EB%A6%BC)


```python
# 브랜드별 3개월 수익률을 레버리지에 따라 다른 색상으로 시각화 합니다.
sns.boxplot(data=df, x="3개월수익률", y="브랜드")
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='브랜드'>




    
![png](output_63_1.png)
    


#### boxplot 보는 방법

* 사분위수 범위(IQR, Interquartile range, Q3-Q1)
* 이상치를 제외한 최댓값  = Q3 + 1.5IQR
* 이상치를 제외한 최솟값  = Q1 - 1.5IQR

### 3개월 수익률에 대한 기술통계 값 구하기


```python
# 위에서 그린 boxplot의 값을 직접 구해봅니다.
brand_3month_desc = df.groupby("브랜드")["3개월수익률"].describe()
brand_3month_desc
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>브랜드</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ARIRANG</th>
      <td>40.0</td>
      <td>1.773385</td>
      <td>3.601803</td>
      <td>-6.2043</td>
      <td>-0.076475</td>
      <td>1.09065</td>
      <td>3.463800</td>
      <td>14.2914</td>
    </tr>
    <tr>
      <th>FOCUS</th>
      <td>2.0</td>
      <td>1.118400</td>
      <td>2.748807</td>
      <td>-0.8253</td>
      <td>0.146550</td>
      <td>1.11840</td>
      <td>2.090250</td>
      <td>3.0621</td>
    </tr>
    <tr>
      <th>HANARO</th>
      <td>18.0</td>
      <td>1.841317</td>
      <td>3.591961</td>
      <td>-1.8159</td>
      <td>-0.643100</td>
      <td>0.71215</td>
      <td>3.760825</td>
      <td>11.6541</td>
    </tr>
    <tr>
      <th>HK</th>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>KBSTAR</th>
      <td>77.0</td>
      <td>0.633323</td>
      <td>6.286317</td>
      <td>-22.5944</td>
      <td>-1.633900</td>
      <td>0.06700</td>
      <td>3.390900</td>
      <td>17.7884</td>
    </tr>
    <tr>
      <th>KINDEX</th>
      <td>47.0</td>
      <td>1.951685</td>
      <td>6.667292</td>
      <td>-22.7317</td>
      <td>-0.645550</td>
      <td>0.74660</td>
      <td>4.778600</td>
      <td>23.6628</td>
    </tr>
    <tr>
      <th>KODEX</th>
      <td>119.0</td>
      <td>0.607034</td>
      <td>6.363148</td>
      <td>-31.1635</td>
      <td>-1.668700</td>
      <td>0.41250</td>
      <td>3.597550</td>
      <td>17.9662</td>
    </tr>
    <tr>
      <th>KOSEF</th>
      <td>24.0</td>
      <td>1.168696</td>
      <td>3.981056</td>
      <td>-7.3596</td>
      <td>-0.883825</td>
      <td>0.13965</td>
      <td>2.895800</td>
      <td>11.6161</td>
    </tr>
    <tr>
      <th>KTOP</th>
      <td>1.0</td>
      <td>-1.231000</td>
      <td>NaN</td>
      <td>-1.2310</td>
      <td>-1.231000</td>
      <td>-1.23100</td>
      <td>-1.231000</td>
      <td>-1.2310</td>
    </tr>
    <tr>
      <th>SMART</th>
      <td>5.0</td>
      <td>2.092920</td>
      <td>4.022589</td>
      <td>-1.0130</td>
      <td>-0.849800</td>
      <td>0.03980</td>
      <td>3.977700</td>
      <td>8.3099</td>
    </tr>
    <tr>
      <th>TIGER</th>
      <td>124.0</td>
      <td>1.938860</td>
      <td>8.025187</td>
      <td>-22.4741</td>
      <td>-1.545075</td>
      <td>0.76115</td>
      <td>4.412950</td>
      <td>48.0795</td>
    </tr>
    <tr>
      <th>TIMEFOLIO</th>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>TREX</th>
      <td>2.0</td>
      <td>-0.624250</td>
      <td>0.795142</td>
      <td>-1.1865</td>
      <td>-0.905375</td>
      <td>-0.62425</td>
      <td>-0.343125</td>
      <td>-0.0620</td>
    </tr>
    <tr>
      <th>네비게이터</th>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>마이다스</th>
      <td>1.0</td>
      <td>0.610100</td>
      <td>NaN</td>
      <td>0.6101</td>
      <td>0.610100</td>
      <td>0.61010</td>
      <td>0.610100</td>
      <td>0.6101</td>
    </tr>
    <tr>
      <th>마이티</th>
      <td>2.0</td>
      <td>1.434750</td>
      <td>3.174556</td>
      <td>-0.8100</td>
      <td>0.312375</td>
      <td>1.43475</td>
      <td>2.557125</td>
      <td>3.6795</td>
    </tr>
    <tr>
      <th>파워</th>
      <td>4.0</td>
      <td>0.970425</td>
      <td>2.782932</td>
      <td>-0.7428</td>
      <td>-0.512475</td>
      <td>-0.24975</td>
      <td>1.233150</td>
      <td>5.1240</td>
    </tr>
    <tr>
      <th>흥국</th>
      <td>1.0</td>
      <td>4.977600</td>
      <td>NaN</td>
      <td>4.9776</td>
      <td>4.977600</td>
      <td>4.97760</td>
      <td>4.977600</td>
      <td>4.9776</td>
    </tr>
  </tbody>
</table>
</div>



<img src="https://miro.medium.com/max/1400/1*NRlqiZGQdsIyAu0KzP7LaQ.png" width="400">

* 이미지 출처 : https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51

### KODEX ETF 따로 분석하기

* ⚠️ 주의사항 ⚠️  분석내용은 데이터 수집 시점에 따라 달라집니다.


```python
# KODEX 서브셋을 만듭니다.
df_kodex = df[df['브랜드'] == "KODEX"].copy()
df_kodex.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>종목코드</th>
      <th>탭코드</th>
      <th>종목명</th>
      <th>현재가</th>
      <th>등락구분</th>
      <th>전일비</th>
      <th>등락률</th>
      <th>순자산가치(NAV)</th>
      <th>3개월수익률</th>
      <th>거래량</th>
      <th>거래대금(백만)</th>
      <th>시가총액(억)</th>
      <th>유형</th>
      <th>브랜드</th>
      <th>인버스</th>
      <th>레버리지</th>
      <th>환헤지H</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>069500</td>
      <td>1</td>
      <td>KODEX 200</td>
      <td>43005</td>
      <td>2</td>
      <td>130</td>
      <td>0.30</td>
      <td>43027.0</td>
      <td>-0.7363</td>
      <td>2409683</td>
      <td>103245</td>
      <td>41672</td>
      <td>국내</td>
      <td>KODEX</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>153130</td>
      <td>6</td>
      <td>KODEX 단기채권</td>
      <td>102845</td>
      <td>3</td>
      <td>0</td>
      <td>0.00</td>
      <td>102846.0</td>
      <td>0.0340</td>
      <td>16993</td>
      <td>1747</td>
      <td>24206</td>
      <td>파생</td>
      <td>KODEX</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>252670</td>
      <td>3</td>
      <td>KODEX 200선물인버스2X</td>
      <td>1930</td>
      <td>5</td>
      <td>-10</td>
      <td>-0.52</td>
      <td>1930.0</td>
      <td>0.0000</td>
      <td>208493318</td>
      <td>404593</td>
      <td>22070</td>
      <td>국내</td>
      <td>KODEX</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>102780</td>
      <td>2</td>
      <td>KODEX 삼성그룹</td>
      <td>10570</td>
      <td>2</td>
      <td>35</td>
      <td>0.33</td>
      <td>10594.0</td>
      <td>3.2033</td>
      <td>254361</td>
      <td>2680</td>
      <td>18180</td>
      <td>시장지수</td>
      <td>KODEX</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>214980</td>
      <td>6</td>
      <td>KODEX 단기채권PLUS</td>
      <td>103150</td>
      <td>5</td>
      <td>-10</td>
      <td>-0.01</td>
      <td>103151.0</td>
      <td>0.0581</td>
      <td>869568</td>
      <td>89698</td>
      <td>14314</td>
      <td>파생</td>
      <td>KODEX</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_kodex.shape
```




    (123, 17)




```python
# KODEX 의 boxplot을 그립니다.
sns.boxplot(data=df_kodex, x="3개월수익률", y='유형')
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='유형'>




    
![png](output_70_1.png)
    



```python
# KODEX 의 boxenplot을 그립니다.
sns.boxenplot(data=df_kodex, x="3개월수익률", y='유형')
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='유형'>




    
![png](output_71_1.png)
    



```python
# KODEX 의 historam 을 pandas로 그립니다.
df_kodex["3개월수익률"].plot.kde()
```




    <AxesSubplot:ylabel='Density'>




    
![png](output_72_1.png)
    



```python
# KODEX 의 kdeplot 을 그립니다. 히스토그램의 밀도를 추정해서 그림.
sns.kdeplot(data=df_kodex, x="3개월수익률")
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='Density'>




    
![png](output_73_1.png)
    



```python
# KODEX 의 violinplot 을 그립니다.
sns.violinplot(data=df_kodex, x="3개월수익률")
```




    <AxesSubplot:xlabel='3개월수익률'>




    
![png](output_74_1.png)
    



```python
# KODEX 의 violinplot 에 hue="레버리지"로 그립니다.
sns.violinplot(data=df_kodex, x="3개월수익률", y="유형", hue='레버리지')
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='유형'>




    
![png](output_75_1.png)
    



```python
# KODEX 의 violinplot 에 hue="레버리지"를 split 옵션을 사용해 그립니다.
sns.violinplot(data=df_kodex, x="3개월수익률", y="유형", hue='레버리지', split=True)
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='유형'>




    
![png](output_76_1.png)
    



```python
# KODEX 의 violinplot 에 hue="인버스"로 그립니다.
sns.violinplot(data=df_kodex, x="3개월수익률", y="유형", hue='인버스', split=True)
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='유형'>




    
![png](output_77_1.png)
    


* 이미지 출처 : [The Datasaurus Dozen - Same Stats, Different Graphs | Autodesk Research](https://www.autodeskresearch.com/publications/samestats)

<img src="https://d2f99xq7vri1nk.cloudfront.net/BoxViolinSmaller.gif">

### 브랜드별 3개월수익률


```python
# boxenplot 을 통해 브랜드별 3개월 수익률을 시각화 합니다.
sns.boxenplot(data=df, x="3개월수익률", y="브랜드")
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='브랜드'>




    
![png](output_79_1.png)
    



```python
# violinplot은 kdeplot을 마주보도록 그린 그래프로 값의 분포를 알 수 있습니다.
# boxplot의 단점을 보완하기 위해 만들어지기도 했는데 내부에 boxplot을 함께 그려줍니다.
# 가운데 점은 중앙값을 의미합니다.
sns.violinplot(data=df, x="3개월수익률", y="브랜드")
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='브랜드'>




    
![png](output_80_1.png)
    


### 서브플롯 그려보기


```python
# boxplot과 violinplot을 하나의 그래프에 같이 그려봅니다.
fig, axes = plt.subplots(1,2, figsize=(12,4))
sns.boxplot(data=df, x="3개월수익률", y="브랜드", ax=axes[0])
sns.violinplot(data=df, x="3개월수익률", y="브랜드", ax=axes[1])
```




    <AxesSubplot:xlabel='3개월수익률', ylabel='브랜드'>




    
![png](output_82_1.png)
    



```python
# violinplot은 kdeplot을 마주보도록 그린 그래프로 값의 분포를 알 수 있습니다.
# boxplot의 단점을 보완하기 위해 만들어지기도 했는데 내부에 boxplot을 함께 그려줍니다.
# 가운데 점은 중앙값을 의미합니다.
# 브랜드별 3개월수익률을 레버리지 여부에 따라 그려봅니다.

```


```python
# 브랜드별 3개월수익률을 인버스 여부에 따라 그려봅니다.

```

### 브랜드별 거래량


```python
# 수집한 날짜에 대한 브랜드별 거래량을 봅니다.

```


```python
# df[df["브랜드"].isin(["TIGER", "KBSTAR", "KINDEX"])]
```


```python
# 전체 브랜드를 보면 값의 크기 차이로 시각화를 제대로 보기 어렵습니다.
# 일부 브랜드 "TIGER", "KBSTAR", "KINDEX" 를 따로 가져와서 시각화 합니다.

```


```python

```


```python

```


```python
# "마이티", "마이다스", "흥국" 만 봅니다.

```


```python
# "마이티", "마이다스", "흥국" 의 기술통계 값 보기

```

### 유형에 따른 거래량


```python
# 유형에 따른 평균 거래량을 barplot으로 시각화 합니다.

```


```python
# 위 그래프의 유형에 따른 평균 거래량을 직접 groupby를 통해 구합니다.

```

### 유형에 따른 거래대금


```python
# 위 그래프의 유형에 따른 평균 거래대금(백만)을 barplot 으로 그립니다.

```


```python
# 위 그래프의 유형에 따른 평균 거래대금(백만)을 직접 groupby를 통해 구합니다.

```


```python
# 위 그래프의 유형에 따른 평균 거래대금(백만)을 직접 pivot_table을 통해 구합니다.

```

### 유형에 따른 시가총액


```python
# 유형에 따른 평균 시가총액(억) 에 대한 시각화를 합니다.

```


```python
# 위 그래프의 유형에 따른 평균 시가총액(억)을 직접 groupby를 통해 구합니다.

```


```python
# 위 그래프의 유형에 따른 평균 시가총액(억)을 직접 pivot_table을 통해 구합니다.

```

### 유형에 따른 3개월 수익률


```python
# 유형에 따른 평균 3개월수익률에 대한 시각화를 합니다.

```


```python
# 위 그래프의 유형에 따른 평균 3개월수익률을 직접 groupby를 통해 구합니다.

```


```python
# 위 그래프의 유형에 따른 평균 3개월수익률을 직접 pivot_table을 통해 구합니다.

```

## 여러 개의 변수로 서브플롯 그리기
### PairGrid와 barplot 으로 서브플롯 그리기


* PairGrid는 한번에 서브플롯을 쉽게 그려볼 수 있는 장점이 있지만 아쉽게도 share axis in PairGrid는 지원하지 않고 있습니다.
* 참고 : https://github.com/mwaskom/seaborn/issues/1032


```python
# PairGrid 와 barplot을 한번에 서브플롯으로 그립니다.
# 유형에 따른 "거래량", "거래대금(백만)", "시가총액(억)", "3개월수익률" 에 대한 시각화를 합니다.
g = sns.PairGrid(data=df, x_vars=["거래량", "거래대금(백만)", "시가총액(억)", "3개월수익률"],
             y_vars=['유형'])

g.map(sns.barplot, ci=None)
```




    <seaborn.axisgrid.PairGrid at 0x2c3fd52ce80>




    
![png](output_109_1.png)
    


### subplots를 통한 시각화


```python
row_cols = ["거래량", "거래대금(백만)", "시가총액(억)", "3개월수익률"]
```


```python

```


```python
# 위 그래프를 직접 subplots 를 사용해 그려봅니다.

```


```python
# 브랜드별 수치 데이터의 평균을 시각화 합니다.

```

### 브랜드별 인버스 여부에 따른 시각화


```python
# subplots를 시각화 합니다. hue="인버스"를 적용해 봅니다.

```

### 브랜드별 레버리지 여부에 따른 시각화


```python
# subplots를 시각화 합니다. hue="레버리지"를 적용해 봅니다.

```


```python
# 위에서 그린 서브플롯을 직접 groupby 로 구해봅니다.

```

### 유형에 따른 3개월 수익률 boxplot 
* barplot으로 그렸을 때 보이지 않던 데이터의 빈도수와 데이터의 분포를 확인할 수 있습니다.



```python
# boxplot 으로 x축에 "유형" y축에 "3개월수익률" 을 그려봅니다.

```


```python
# boxplot의 유형에 따른 3개월 수익률에 대한 기술통계 값을 구합니다.

```

### subplots 로 유형에 대한 boxplot 그리기


```python

```


```python
# subplots 를 통한 유형에 따른 수치데이터의 평균값 구하기

```


```python
# hue="레버리지" 를 추가해서 그립니다.

```

### subplots 로 유형에 대한  violinplot 그리기
* boxplot으로 그렸을 때 박스 안의 분포를 좀 더 자세히 그려줍니다.


```python
# 유형에 따른 violinplot 

```


```python
# 유형에 따른 violinplot 에 hue="레버리지" 적용하기

```

### PairGrid 를 통해 여러 변수의 violinplot 그리기


```python
# 브랜드에 따른 여러 수치변수의 violinplot 를 PairGrid로 그리기

```

### subplots 로 브랜드에 대한 boxplot 그리기


```python
# 브랜드에 따른 여러 수치변수의 boxplot 을 subplots으로 그리기 : hue="레버리지"

```

### subplots 로 브랜드에 대한 violinplot 그리기


```python
# 브랜드에 따른 여러 수치변수의 violinplot 을 subplots으로 그리기 : hue="레버리지"


```

## FacetGrid 를 통한 범주형 변수에 대한 서브플롯 그리기


```python
# catplot 을 통한 브랜드별 3개월 수익률
sns.catplot(data=df, y='브랜드', x='3개월수익률')
```




    <seaborn.axisgrid.FacetGrid at 0x2c3fe225e80>




    
![png](output_137_1.png)
    



```python
# catplot 을 통한 브랜드별 3개월 수익률 : kind="bar"
sns.catplot(data=df, y='브랜드', x='3개월수익률', kind='bar',ci=None, hue='인버스',
            col="유형", col_wrap=3)
```




    <seaborn.axisgrid.FacetGrid at 0x2c3fe062850>




    
![png](output_138_1.png)
    



```python
# catplot 을 통한 브랜드별 3개월 수익률 : kind="box"
sns.catplot(data=df, y='브랜드', x='3개월수익률', kind='box',ci=None, hue='인버스',
            col="유형", col_wrap=3)
```




    <seaborn.axisgrid.FacetGrid at 0x2c3db30fa00>




    
![png](output_139_1.png)
    



```python
# catplot 을 통한 브랜드별 3개월 수익률 : kind="violin"
sns.catplot(data=df, y='브랜드', x='3개월수익률', kind='violin',ci=None, hue='인버스',
            col="유형", col_wrap=3)
```




    <seaborn.axisgrid.FacetGrid at 0x2c3dbcfae80>




    
![png](output_140_1.png)
    


### 특정 범주형 변수에 대한 서브플롯 그리기 - catplot
#### 브랜드 별 빈도수 - countplot


```python
sns.catplot(data=df, y="브랜드", kind='count',
            col='유형', col_wrap=2)
```




    <seaborn.axisgrid.FacetGrid at 0x2c3db298e80>




    
![png](output_142_1.png)
    


#### 브랜드별 3개월 수익률 - barplot


```python

```

#### 브랜드별 거래량 - barplot


```python

```

## 해외 주식 ETF


```python
# 유형이 "해외 주식"인 ETF만 가져옵니다.
# oversea

```


```python
# "해외 주식"ETF의 브랜드별 "3개월수익률"을 시각화 합니다.

```


```python
# "해외 주식"ETF의 브랜드별 평균 "3개월수익률"을 hue="환헤지H"로 시각화 합니다.

```


```python
# "해외 주식"ETF의 브랜드별 평균 "3개월수익률"을 violinplot으로 시각화 합니다.

```


```python
# 위에서 그린 그래프를 catplot을 통해 그리며  col="레버리지", row="인버스"로 시각화 합니다.

```


## 상관분석

상관 분석(相關 分析, Correlation analysis) 또는 '상관관계' 또는 '상관'은 확률론과 통계학에서 두 변수간에 어떤 선형적 또는 비선형적 관계를 갖고 있는지를 분석하는 방법이다. 두 변수는 서로 독립적인 관계이거나 상관된 관계일 수 있으며 이때 두 변수간의 관계의 강도를 상관관계(Correlation, Correlation coefficient)라 한다. 상관분석에서는 상관관계의 정도를 나타내는 단위로 모상관계수로 ρ를 사용하며 표본 상관 계수로 r 을 사용한다.

상관관계의 정도를 파악하는 상관 계수(相關係數, Correlation coefficient)는 두 변수간의 연관된 정도를 나타낼 뿐 인과관계를 설명하는 것은 아니다. 두 변수간에 원인과 결과의 인과관계가 있는지에 대한 것은 회귀분석을 통해 인과관계의 방향, 정도와 수학적 모델을 확인해 볼 수 있다.

* 출처 : https://ko.wikipedia.org/wiki/%EC%83%81%EA%B4%80_%EB%B6%84%EC%84%9D

### 피어슨 상관계수

* r 값은 X 와 Y 가 완전히 동일하면 +1, 전혀 다르면 0, 반대방향으로 완전히 동일 하면 –1 을 가진다. 
* 결정계수(coefficient of determination)는 r^2 로 계산하며 이것은 X 로부터 Y 를 예측할 수 있는 정도를 의미한다.

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Correlation_examples2.svg/800px-Correlation_examples2.svg.png" width="500">

```
일반적으로
r이 -1.0과 -0.7 사이이면, 강한 음적 선형관계,
r이 -0.7과 -0.3 사이이면, 뚜렷한 음적 선형관계,
r이 -0.3과 -0.1 사이이면, 약한 음적 선형관계,
r이 -0.1과 +0.1 사이이면, 거의 무시될 수 있는 선형관계,
r이 +0.1과 +0.3 사이이면, 약한 양적 선형관계,
r이 +0.3과 +0.7 사이이면, 뚜렷한 양적 선형관계,
r이 +0.7과 +1.0 사이이면, 강한 양적 선형관계
```

<img src="https://upload.wikimedia.org/wikipedia/commons/3/34/Correlation_coefficient.png" width=500>

* 출처 :  https://ko.wikipedia.org/wiki/%EC%83%81%EA%B4%80_%EB%B6%84%EC%84%9D#%ED%94%BC%EC%96%B4%EC%8A%A8_%EC%83%81%EA%B4%80_%EA%B3%84%EC%88%98



### 상관계수 구하기


```python
# 전체 데이터프레임에 대한 상관계수를 구합니다.
corr = df.corr()
```


```python
# np.triu : matrix를 상삼각행렬로 만드는 numpy math
# [1 2 3]   np.triu  [1 2 3]
# [4 5 6]   -------> [0 5 6]
# [2 3 4]            [0 0 4]
# np.ones_like(x) : x와 크기만 같은 1로 이루어진 array를 만듬

# 수식적으로 어려워 보일수도 있지만 간단함
# 자기상관계수는 대각행렬을 기준으로 대칭되어 같은 값이 출력되므로,
# 이대로 전체를 heatmap을 plot하면 오히려 가독성이 떨어질 수 있음
# 이에, 가독성을 높이기 위해 대각행렬 기준으로 한쪽의 데이터들만 masking 기법을 통해 plot하여 
# 가독성을 높이는 효과를 가질수 있음
# np.ones_like로 heatmap의 마스크값 구하기
mask = np.triu(np.ones_like(corr))
```


```python
print(plt.colormaps())
```

    ['Accent', 'Accent_r', 'Blues', 'Blues_r', 'BrBG', 'BrBG_r', 'BuGn', 'BuGn_r', 'BuPu', 'BuPu_r', 'CMRmap', 'CMRmap_r', 'Dark2', 'Dark2_r', 'GnBu', 'GnBu_r', 'Greens', 'Greens_r', 'Greys', 'Greys_r', 'OrRd', 'OrRd_r', 'Oranges', 'Oranges_r', 'PRGn', 'PRGn_r', 'Paired', 'Paired_r', 'Pastel1', 'Pastel1_r', 'Pastel2', 'Pastel2_r', 'PiYG', 'PiYG_r', 'PuBu', 'PuBuGn', 'PuBuGn_r', 'PuBu_r', 'PuOr', 'PuOr_r', 'PuRd', 'PuRd_r', 'Purples', 'Purples_r', 'RdBu', 'RdBu_r', 'RdGy', 'RdGy_r', 'RdPu', 'RdPu_r', 'RdYlBu', 'RdYlBu_r', 'RdYlGn', 'RdYlGn_r', 'Reds', 'Reds_r', 'Set1', 'Set1_r', 'Set2', 'Set2_r', 'Set3', 'Set3_r', 'Spectral', 'Spectral_r', 'Wistia', 'Wistia_r', 'YlGn', 'YlGnBu', 'YlGnBu_r', 'YlGn_r', 'YlOrBr', 'YlOrBr_r', 'YlOrRd', 'YlOrRd_r', 'afmhot', 'afmhot_r', 'autumn', 'autumn_r', 'binary', 'binary_r', 'bone', 'bone_r', 'brg', 'brg_r', 'bwr', 'bwr_r', 'cividis', 'cividis_r', 'cool', 'cool_r', 'coolwarm', 'coolwarm_r', 'copper', 'copper_r', 'crest', 'crest_r', 'cubehelix', 'cubehelix_r', 'flag', 'flag_r', 'flare', 'flare_r', 'gist_earth', 'gist_earth_r', 'gist_gray', 'gist_gray_r', 'gist_heat', 'gist_heat_r', 'gist_ncar', 'gist_ncar_r', 'gist_rainbow', 'gist_rainbow_r', 'gist_stern', 'gist_stern_r', 'gist_yarg', 'gist_yarg_r', 'gnuplot', 'gnuplot2', 'gnuplot2_r', 'gnuplot_r', 'gray', 'gray_r', 'hot', 'hot_r', 'hsv', 'hsv_r', 'icefire', 'icefire_r', 'inferno', 'inferno_r', 'jet', 'jet_r', 'magma', 'magma_r', 'mako', 'mako_r', 'nipy_spectral', 'nipy_spectral_r', 'ocean', 'ocean_r', 'pink', 'pink_r', 'plasma', 'plasma_r', 'prism', 'prism_r', 'rainbow', 'rainbow_r', 'rocket', 'rocket_r', 'seismic', 'seismic_r', 'spring', 'spring_r', 'summer', 'summer_r', 'tab10', 'tab10_r', 'tab20', 'tab20_r', 'tab20b', 'tab20b_r', 'tab20c', 'tab20c_r', 'terrain', 'terrain_r', 'turbo', 'turbo_r', 'twilight', 'twilight_r', 'twilight_shifted', 'twilight_shifted_r', 'viridis', 'viridis_r', 'vlag', 'vlag_r', 'winter', 'winter_r']
    


```python
# seaborn 의 heatmap으로 상관 계수 시각화 하기
plt.figure(figsize=(16,5))
sns.heatmap(corr, annot=True, fmt=".2f", mask=mask, cmap='seismic', vmax=1, vmin=-1)
```




    <AxesSubplot:>




    
![png](output_157_1.png)
    


### 양 혹은 음의 상관 계수가 높은 변수끼리의 regplot 그리기


```python
# regplot을 통해 양의 상관 계수가 높은 변수끼리 시각화 합니다.
sns.regplot(data=df, x="현재가", y="순자산가치(NAV)")
```




    <AxesSubplot:xlabel='현재가', ylabel='순자산가치(NAV)'>




    
![png](output_159_1.png)
    



```python
# regplot을 통해 음의 상관 계수가 높은 변수끼리 시각화 합니다.
sns.regplot(data=df, x='등락구분', y='등락률')
```




    <AxesSubplot:xlabel='등락구분', ylabel='등락률'>




    
![png](output_160_1.png)
    


### 종목별 상관 계수


```python
# select_dtypes 를 통해 object 타입을 제외한 타입을 제외하고 가져오록 합니다.
# 종목명을 인덱스로 만들어 줍니다.
df_num = df.select_dtypes(exclude=np.object).astype(float)
df_num['종목명'] = df['종목명']
df_num = df_num.set_index('종목명')
```


```python
# transpose 로 행과 열을 바꿉니다.
df_t = df_num.T
df_t.head(2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>종목명</th>
      <th>KODEX 200</th>
      <th>KODEX 단기채권</th>
      <th>KODEX 200선물인버스2X</th>
      <th>TIGER 200</th>
      <th>KODEX 삼성그룹</th>
      <th>KODEX 단기채권PLUS</th>
      <th>KODEX 레버리지</th>
      <th>KODEX 종합채권(AA-이상)액티브</th>
      <th>KODEX 200TR</th>
      <th>TIGER TOP10</th>
      <th>...</th>
      <th>KBSTAR 모멘텀밸류</th>
      <th>KBSTAR 200에너지화학</th>
      <th>KODEX MSCI EM선물(H)</th>
      <th>KBSTAR 국채선물10년</th>
      <th>KBSTAR 200철강소재</th>
      <th>KBSTAR 미국장기국채선물인버스2X(합성 H)</th>
      <th>KBSTAR 200생활소비재</th>
      <th>KBSTAR 팔라듐선물인버스(H)</th>
      <th>KBSTAR 200경기소비재</th>
      <th>KBSTAR 200산업재</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>탭코드</th>
      <td>1.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>...</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>현재가</th>
      <td>43005.0</td>
      <td>102845.0</td>
      <td>1930.0</td>
      <td>43020.0</td>
      <td>10570.0</td>
      <td>103150.0</td>
      <td>27990.0</td>
      <td>109845.0</td>
      <td>14065.0</td>
      <td>14750.0</td>
      <td>...</td>
      <td>15420.0</td>
      <td>13995.0</td>
      <td>10060.0</td>
      <td>56415.0</td>
      <td>10180.0</td>
      <td>5790.0</td>
      <td>8880.0</td>
      <td>4545.0</td>
      <td>11835.0</td>
      <td>13370.0</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 489 columns</p>
</div>




```python
# df_t의 데이터 타입을 float 으로 변경하고 상관 계수 구하기
etf_corr = df_t.corr()
etf_corr.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>종목명</th>
      <th>KODEX 200</th>
      <th>KODEX 단기채권</th>
      <th>KODEX 200선물인버스2X</th>
      <th>TIGER 200</th>
      <th>KODEX 삼성그룹</th>
      <th>KODEX 단기채권PLUS</th>
      <th>KODEX 레버리지</th>
      <th>KODEX 종합채권(AA-이상)액티브</th>
      <th>KODEX 200TR</th>
      <th>TIGER TOP10</th>
      <th>...</th>
      <th>KBSTAR 모멘텀밸류</th>
      <th>KBSTAR 200에너지화학</th>
      <th>KODEX MSCI EM선물(H)</th>
      <th>KBSTAR 국채선물10년</th>
      <th>KBSTAR 200철강소재</th>
      <th>KBSTAR 미국장기국채선물인버스2X(합성 H)</th>
      <th>KBSTAR 200생활소비재</th>
      <th>KBSTAR 팔라듐선물인버스(H)</th>
      <th>KBSTAR 200경기소비재</th>
      <th>KBSTAR 200산업재</th>
    </tr>
    <tr>
      <th>종목명</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>KODEX 200</th>
      <td>1.000000</td>
      <td>0.001575</td>
      <td>0.998971</td>
      <td>0.999231</td>
      <td>0.997396</td>
      <td>0.989677</td>
      <td>0.999637</td>
      <td>-0.075112</td>
      <td>0.723419</td>
      <td>0.998177</td>
      <td>...</td>
      <td>-0.106616</td>
      <td>-0.062421</td>
      <td>-0.055598</td>
      <td>-0.106464</td>
      <td>0.012802</td>
      <td>0.706885</td>
      <td>0.078566</td>
      <td>0.313129</td>
      <td>-0.086809</td>
      <td>0.079647</td>
    </tr>
    <tr>
      <th>KODEX 단기채권</th>
      <td>0.001575</td>
      <td>1.000000</td>
      <td>-0.017149</td>
      <td>0.040784</td>
      <td>0.040076</td>
      <td>0.128651</td>
      <td>-0.017922</td>
      <td>0.993879</td>
      <td>0.620238</td>
      <td>0.050537</td>
      <td>...</td>
      <td>0.979461</td>
      <td>0.983223</td>
      <td>0.966450</td>
      <td>0.979345</td>
      <td>0.985037</td>
      <td>0.731512</td>
      <td>0.981885</td>
      <td>0.941676</td>
      <td>0.981412</td>
      <td>0.981655</td>
    </tr>
    <tr>
      <th>KODEX 200선물인버스2X</th>
      <td>0.998971</td>
      <td>-0.017149</td>
      <td>1.000000</td>
      <td>0.997483</td>
      <td>0.996452</td>
      <td>0.984181</td>
      <td>0.999674</td>
      <td>-0.092689</td>
      <td>0.709270</td>
      <td>0.997166</td>
      <td>...</td>
      <td>-0.122896</td>
      <td>-0.078777</td>
      <td>-0.067764</td>
      <td>-0.122749</td>
      <td>-0.003542</td>
      <td>0.698747</td>
      <td>0.062330</td>
      <td>0.301975</td>
      <td>-0.103156</td>
      <td>0.063387</td>
    </tr>
    <tr>
      <th>TIGER 200</th>
      <td>0.999231</td>
      <td>0.040784</td>
      <td>0.997483</td>
      <td>1.000000</td>
      <td>0.998118</td>
      <td>0.993901</td>
      <td>0.998114</td>
      <td>-0.036035</td>
      <td>0.746980</td>
      <td>0.999324</td>
      <td>...</td>
      <td>-0.068029</td>
      <td>-0.023722</td>
      <td>-0.027014</td>
      <td>-0.067882</td>
      <td>0.051510</td>
      <td>0.726745</td>
      <td>0.117098</td>
      <td>0.340113</td>
      <td>-0.048162</td>
      <td>0.118169</td>
    </tr>
    <tr>
      <th>KODEX 삼성그룹</th>
      <td>0.997396</td>
      <td>0.040076</td>
      <td>0.996452</td>
      <td>0.998118</td>
      <td>1.000000</td>
      <td>0.988546</td>
      <td>0.996175</td>
      <td>-0.040590</td>
      <td>0.761998</td>
      <td>0.999469</td>
      <td>...</td>
      <td>-0.077146</td>
      <td>-0.032930</td>
      <td>-0.033711</td>
      <td>-0.077052</td>
      <td>0.042201</td>
      <td>0.720965</td>
      <td>0.107706</td>
      <td>0.333233</td>
      <td>-0.057334</td>
      <td>0.108699</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 489 columns</p>
</div>



* "KODEX 200" 과 상관계수가 높은 ETF 상위 10개


```python
sns.heatmap(etf_corr)
```




    <AxesSubplot:xlabel='종목명', ylabel='종목명'>




    
![png](output_166_1.png)
    



```python
sns.heatmap(etf_corr, cmap="coolwarm", vmax=1, vmin=-1)
```




    <AxesSubplot:xlabel='종목명', ylabel='종목명'>




    
![png](output_167_1.png)
    



```python
# "KODEX 200" 과 상관계수가 높은 ETF 상위 10개
etf_corr["KODEX 200"].sort_values().tail(10).plot.barh()
```




    <AxesSubplot:ylabel='종목명'>




    
![png](output_168_1.png)
    


* "KODEX 200" 과 상관계수가 낮은 ETF 하위 10개


```python
# "KODEX 200" 과 상관계수가 낮은 ETF 하위 10개
etf_corr["KODEX 200"].sort_values().head(10).plot.barh()
```




    <AxesSubplot:ylabel='종목명'>




    
![png](output_170_1.png)
    


### 2X ETF의 상관계수


```python
# 2X가 들어가는 ETF의 상관 계수만 가져오기
etf_corr_2x = etf_corr.filter(regex="2X", axis=1).filter(regex="2X", axis=0)
etf_corr_2x
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>종목명</th>
      <th>KODEX 200선물인버스2X</th>
      <th>TIGER 200선물인버스2X</th>
      <th>KBSTAR 200선물인버스2X</th>
      <th>KOSEF 미국달러선물인버스2X</th>
      <th>ARIRANG 200선물인버스2X</th>
      <th>KOSEF 200선물인버스2X</th>
      <th>TIGER 미국달러선물인버스2X</th>
      <th>KBSTAR KRX국채선물3년10년스티프너2X</th>
      <th>KBSTAR KRX국채선물3년10년플래트너2X</th>
      <th>KODEX 미국달러선물인버스2X</th>
      <th>KBSTAR 미국장기국채선물인버스2X(합성 H)</th>
    </tr>
    <tr>
      <th>종목명</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>KODEX 200선물인버스2X</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.999933</td>
      <td>-0.017650</td>
      <td>0.994997</td>
      <td>0.999018</td>
      <td>-0.120715</td>
      <td>-0.123183</td>
      <td>-0.123498</td>
      <td>0.752491</td>
      <td>0.698747</td>
    </tr>
    <tr>
      <th>TIGER 200선물인버스2X</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.999940</td>
      <td>-0.017045</td>
      <td>0.995058</td>
      <td>0.999045</td>
      <td>-0.120115</td>
      <td>-0.122585</td>
      <td>-0.122899</td>
      <td>0.752889</td>
      <td>0.699067</td>
    </tr>
    <tr>
      <th>KBSTAR 200선물인버스2X</th>
      <td>0.999933</td>
      <td>0.999940</td>
      <td>1.000000</td>
      <td>-0.006113</td>
      <td>0.996084</td>
      <td>0.999463</td>
      <td>-0.109263</td>
      <td>-0.111744</td>
      <td>-0.112059</td>
      <td>0.760029</td>
      <td>0.704826</td>
    </tr>
    <tr>
      <th>KOSEF 미국달러선물인버스2X</th>
      <td>-0.017650</td>
      <td>-0.017045</td>
      <td>-0.006113</td>
      <td>1.000000</td>
      <td>0.082304</td>
      <td>0.026652</td>
      <td>0.994616</td>
      <td>0.994290</td>
      <td>0.994238</td>
      <td>0.645144</td>
      <td>0.750764</td>
    </tr>
    <tr>
      <th>ARIRANG 200선물인버스2X</th>
      <td>0.994997</td>
      <td>0.995058</td>
      <td>0.996084</td>
      <td>0.082304</td>
      <td>1.000000</td>
      <td>0.998445</td>
      <td>-0.020972</td>
      <td>-0.023473</td>
      <td>-0.023792</td>
      <td>0.814504</td>
      <td>0.749636</td>
    </tr>
    <tr>
      <th>KOSEF 200선물인버스2X</th>
      <td>0.999018</td>
      <td>0.999045</td>
      <td>0.999463</td>
      <td>0.026652</td>
      <td>0.998445</td>
      <td>1.000000</td>
      <td>-0.076638</td>
      <td>-0.079126</td>
      <td>-0.079442</td>
      <td>0.780912</td>
      <td>0.721818</td>
    </tr>
    <tr>
      <th>TIGER 미국달러선물인버스2X</th>
      <td>-0.120715</td>
      <td>-0.120115</td>
      <td>-0.109263</td>
      <td>0.994616</td>
      <td>-0.020972</td>
      <td>-0.076638</td>
      <td>1.000000</td>
      <td>0.999940</td>
      <td>0.999908</td>
      <td>0.562912</td>
      <td>0.651462</td>
    </tr>
    <tr>
      <th>KBSTAR KRX국채선물3년10년스티프너2X</th>
      <td>-0.123183</td>
      <td>-0.122585</td>
      <td>-0.111744</td>
      <td>0.994290</td>
      <td>-0.023473</td>
      <td>-0.079126</td>
      <td>0.999940</td>
      <td>1.000000</td>
      <td>0.999995</td>
      <td>0.560857</td>
      <td>0.648876</td>
    </tr>
    <tr>
      <th>KBSTAR KRX국채선물3년10년플래트너2X</th>
      <td>-0.123498</td>
      <td>-0.122899</td>
      <td>-0.112059</td>
      <td>0.994238</td>
      <td>-0.023792</td>
      <td>-0.079442</td>
      <td>0.999908</td>
      <td>0.999995</td>
      <td>1.000000</td>
      <td>0.560581</td>
      <td>0.648515</td>
    </tr>
    <tr>
      <th>KODEX 미국달러선물인버스2X</th>
      <td>0.752491</td>
      <td>0.752889</td>
      <td>0.760029</td>
      <td>0.645144</td>
      <td>0.814504</td>
      <td>0.780912</td>
      <td>0.562912</td>
      <td>0.560857</td>
      <td>0.560581</td>
      <td>1.000000</td>
      <td>0.970475</td>
    </tr>
    <tr>
      <th>KBSTAR 미국장기국채선물인버스2X(합성 H)</th>
      <td>0.698747</td>
      <td>0.699067</td>
      <td>0.704826</td>
      <td>0.750764</td>
      <td>0.749636</td>
      <td>0.721818</td>
      <td>0.651462</td>
      <td>0.648876</td>
      <td>0.648515</td>
      <td>0.970475</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>




```python
# np.ones_like로 heatmap의 마스크값 구하기
mask_2x = np.triu(np.ones_like(etf_corr_2x))
```


```python
# seaborn 의 heatmap으로 상관 계수 시각화 하기
sns.heatmap(etf_corr_2x, annot=True, fmt=".2f", cmap="coolwarm", vmax=1, vmin=-1, mask=mask_2x)
```




    <AxesSubplot:xlabel='종목명', ylabel='종목명'>




    
![png](output_174_1.png)
    


### 원유와 관련된 ETF의 상관계수 보기


```python
# 원유가 들어가는 상관계수만 가져오기
etf_corr_oil = etf_corr.filter(regex="원유", axis=0).filter(regex="원유", axis=1)
etf_corr_oil
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>종목명</th>
      <th>KODEX WTI원유선물(H)</th>
      <th>TIGER 원유선물Enhanced(H)</th>
      <th>KBSTAR 미국S&amp;P원유생산기업(합성 H)</th>
      <th>KODEX WTI원유선물인버스(H)</th>
      <th>TIGER 원유선물인버스(H)</th>
    </tr>
    <tr>
      <th>종목명</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>KODEX WTI원유선물(H)</th>
      <td>1.000000</td>
      <td>0.999823</td>
      <td>0.999607</td>
      <td>0.878813</td>
      <td>0.387875</td>
    </tr>
    <tr>
      <th>TIGER 원유선물Enhanced(H)</th>
      <td>0.999823</td>
      <td>1.000000</td>
      <td>0.999949</td>
      <td>0.870587</td>
      <td>0.372169</td>
    </tr>
    <tr>
      <th>KBSTAR 미국S&amp;P원유생산기업(합성 H)</th>
      <td>0.999607</td>
      <td>0.999949</td>
      <td>1.000000</td>
      <td>0.866072</td>
      <td>0.363684</td>
    </tr>
    <tr>
      <th>KODEX WTI원유선물인버스(H)</th>
      <td>0.878813</td>
      <td>0.870587</td>
      <td>0.866072</td>
      <td>1.000000</td>
      <td>0.780649</td>
    </tr>
    <tr>
      <th>TIGER 원유선물인버스(H)</th>
      <td>0.387875</td>
      <td>0.372169</td>
      <td>0.363684</td>
      <td>0.780649</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>




```python
# np.ones_like로 heatmap의 마스크값 구하기
mask_oil = np.triu(np.ones_like(etf_corr_oil))
```


```python
# seaborn 의 heatmap으로 상관 계수 시각화 하기
sns.heatmap()
```


```python
corr_kbstar = etf_corr.filter(regex="KBSTAR", axis=0).filter(regex="KBSTAR", axis=1)
kbstar_mask = np.triu(np.ones_like(corr_kbstar))
sns.heatmap(corr_kbstar, mask=kbstar_mask, cmap="coolwarm")
```




    <AxesSubplot:xlabel='종목명', ylabel='종목명'>




    
![png](output_179_1.png)
    


## seaborn 공식문서

* seaborn 에 대해 좀 더 알고 싶다면 다음의 튜토리얼을 참고해 보세요.
* [User guide and tutorial — seaborn documentation](https://seaborn.pydata.org/tutorial.html)


```python

```


```python

```


```python

```
